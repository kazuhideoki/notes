# オート輪番要件定義

## Links

[[2025-03-31]] [[2025-04-01]] [[2025-04-02]] [[2025-04-07]]

## Backlog Link

https://yourstand.backlog.com/view/PDM_S-1847

## メモ

### 成果物

- 技術的な達成方法案つくる
- 説明可能な状態

### 要求

- 制御版OCPPでやる
- 最大供給電力内で充電
- 輪番 -> プラグインの順番に充電。満充電で次へ
- 予約しない -> reservation がない
- 認証なし
- 利用ログ(充電時間、消費電力)
- (いずれ)利用可能な時間の設定

### ローカルコントローラー

読んでみる
- どういう責務？
- 何ができる？

### ポイント

#### ローカルコントローラー使うかどうか？

- ローカルコントローラーで実装
	- FW側で工数大きくなる
	- 接続なくても動作できる
	- 制御部分のログが隠蔽される -> GCP に投げて貰えばいいか？
	- 同じ制御方法をPulserPlus/Pit-2G への横展開がしにくい
	- 他データに依存する違う制御方法への拡張がしにくい
- サーバー側にロジック持つ
	- SW側で工数大きくなる
	- 接続ないと動作しない -> 最大供給電力以下で行うことが困難になるかも
	- サービス全体のログを追いやすい
	- 同じ制御方法をPulserPlus/Pit-2G への横展開がしやすい
	- 他データに依存する違う制御方法への拡張がしやすい

#### ソフトウェア側の改修について

- 「予約」が前提となっているロジックの改修 -> 結び付けを剥がす

### [[2025-04-02]] のFWチームとの議論

- FWより ローカルコントローラー -> 横展開しにくい
- サーバー主導 -> 通信切れた時最大供給電力を超えかねない
- リレーオフ方式
	- ⭐️ 台数固定でリレーオンする（最大供給電力を変えない工夫)
		- えいやで次充電するの決める
		- ※ 余裕の台数と残りの充電器によってラグが出る
		- ※ リレーのオンオフが多くなってしまう
- リレーオン方式
	- 問題1 待機電力 
	- 挿されてから止めるは非現実的かも -> 15A(3kW)に一気に行ってしまうかも

イベントドリブン的ではなく、Cron Job 的ロジックになりそうです。

⭐️ローカルコントローラーの仕様に関して調べる -> FW

### 設計

#### ポイント
- 最大供給電力
- 制御命令
- 予約なし

- A
  - 無駄な時間が発生しすぎる。
  - 細切れ充電になってしまう
- C
  - 満充電一時停止後、別の車にプラグインされた場合？ -> 何かしらの理由で充電停止したらリレーをオフにする
  - 充電停止失敗に関しては、充電されているものとして他に充電開始リクエストを減らす
  - 充電開始できたが、ステータスが来ていない場合、諦める。-> ローカルだと解決可能
    - 定期実行の感覚を広げるとその間に復旧する可能性はある。

## 4/7 のFWとの 第2回ミーティング

サーバー手動とFW手動の双方の方法を共有

### サーバー手動

- [x] C案でも、SetChargingProfile でできそうな気はする

### ローカルコントローラー版

- [x] C2 でも、21台以上の場合、別途のネットワークが必要 -> 

### 感想

- 台数21以上や、biz的に制御盤のみでいく方向性が強そうなら
- すごく厳密な最大供給電力に対する要求
- 最大時間の概念で安全運用？

- [x] リレー寿命に関して。-> 営業時間導入でいけるか？
