# Zed 拡張機能の制約調査

## Links

- [[2025-03-08]]

## Zed拡張APIの制約と可能性

このページは、Zed Editor の拡張機能 API を用いた D2 ファイルの自動プレビュー（画像生成と表示）実現の可能性について調査した結果をまとめたものです。
ChatGPT Deep Research https://chatgpt.com/share/67cba22f-26dc-800a-81de-512089ba80bb

## 1. ファイル保存イベントのフック

- **概要**: Zed Editor の現行拡張機能 API では、ファイル保存時のイベントを直接キャッチする仕組みが提供されていません。
- **詳細**: VS Code の onDidSaveTextDocument のようなイベントハンドリングは用意されておらず、自動トリガーによる処理は実現が難しい状況です。

## 2. 外部プロセスの実行

- **概要**: セキュリティ上の理由から、拡張機能から任意の外部プロセス（例：D2 CLI）の実行は大きく制限されています。
- **詳細**: 言語サーバーとして外部プロセスを起動するケースはあるものの、D2 CLI のような単発コマンドを自由に実行する API は提供されていません。
  ※代替として、Zed のタスク機能を使い、ユーザーが手動で実行する形が考えられます。

## 3. 生成画像の保存と管理

- **概要**: 拡張機能はサンドボックス内で動作するため、任意のディレクトリへのファイル出力は制限されています。
- **詳細**: 拡張機能が書き込めるのは、専用のワークディレクトリのみとなるため、プロジェクト内への直接保存はできません。

## 4. 画像の表示方法

- **概要**: Zed Editor 自体は画像ファイル（SVG/PNG）のプレビュー表示機能を備えていますが、拡張機能から直接画像を「開く」命令を出す API は存在しません。
- **詳細**: 生成された画像を表示するには、ユーザーが手動でファイルを開く必要があります。OS のデフォルトビューアを起動する機能も拡張機能側では提供されていません。

## 5. コマンドパレットとの統合

- **概要**: 現状、拡張機能が標準のコマンドパレット (Cmd+P) に独自のコマンドを追加することはできません。
- **詳細**: ユーザー定義のタスクや、Slash コマンド（Assistant パネル内で「/」から実行するもの）での連携は可能ですが、通常のコマンドパレットへの統合はサポートされていません。

## 総合評価

現状、Zed Editor の拡張機能 API はセキュリティとサンドボックスの制約から、D2 CLI を用いた自動プレビュー表示（自動トリガー、外部プロセス実行、画像の自動表示）の実装には大きな制約があります。
そのため、現時点で実現可能な方法は、Zed のタスク機能を活用し、ユーザーが手動で画像生成・表示を行うアプローチになると考えられます。
